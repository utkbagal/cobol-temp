       IDENTIFICATION DIVISION.
       PROGRAM-ID. PAGEWISE-REPORT.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT INPUT-FILE ASSIGN TO "INPUT.DAT"
               ORGANIZATION IS LINE SEQUENTIAL.
           SELECT OUTPUT-FILE ASSIGN TO "REPORT.TXT"
               ORGANIZATION IS LINE SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD INPUT-FILE.
       01 INPUT-RECORD.
           05 ACCOUNT-NO      PIC X(10).
           05 NAME            PIC X(20).
           05 OFFICER-CODE    PIC X(5).
           05 DIVISION        PIC X(10).
           05 FLAG            PIC X(1).
           05 OD-DATE         PIC X(10).
           05 OD-AMT          PIC 9(8)V99.
           05 COMMENT         PIC X(50).

       FD OUTPUT-FILE.
       01 OUTPUT-RECORD      PIC X(132).

       WORKING-STORAGE SECTION.
       01 WS-CURRENT-DIVISION PIC X(10) VALUE SPACES.
       01 WS-PAGE-NUMBER      PIC 9(4) VALUE 1.
       01 WS-TOTAL-AMT        PIC 9(10)V99 VALUE ZERO.
       01 WS-DATE-AMOUNTS.
           05 WS-DISTINCT-DATE OCCURS 100 TIMES INDEXED BY WS-DATE-INDEX.
               10 WS-DATE      PIC X(10).
               10 WS-DATE-AMT  PIC 9(10)V99.

       PROCEDURE DIVISION.
       MAIN-PROCESS.
           OPEN INPUT INPUT-FILE
           OPEN OUTPUT OUTPUT-FILE

           PERFORM READ-INPUT-FILE UNTIL EOF-REACHED

           CLOSE INPUT-FILE
           CLOSE OUTPUT-FILE
           STOP RUN.

       READ-INPUT-FILE.
           READ INPUT-FILE INTO INPUT-RECORD
               AT END
                   MOVE "YES" TO EOF-REACHED
               NOT AT END
                   PERFORM PROCESS-RECORD.

       PROCESS-RECORD.
           IF WS-CURRENT-DIVISION NOT = DIVISION
               PERFORM NEW-PAGE
               MOVE DIVISION TO WS-CURRENT-DIVISION
           END-IF

           PERFORM WRITE-DETAIL-LINE
           PERFORM UPDATE-TOTAL-AMT.

       NEW-PAGE.
           IF WS-TOTAL-AMT > 0
               PERFORM WRITE-SUMMARY
           END-IF
           MOVE ZERO TO WS-TOTAL-AMT
           MOVE WS-PAGE-NUMBER + 1 TO WS-PAGE-NUMBER
           WRITE OUTPUT-RECORD FROM "PAGE: " WS-PAGE-NUMBER
           WRITE OUTPUT-RECORD FROM "DIVISION: " WS-CURRENT-DIVISION.

       WRITE-DETAIL-LINE.
           STRING ACCOUNT-NO DELIMITED BY SPACE
                  NAME DELIMITED BY SPACE
                  DIVISION DELIMITED BY SPACE
                  OFFICER-CODE DELIMITED BY SPACE
                  OD-DATE DELIMITED BY SPACE
                  OD-AMT DELIMITED BY SPACE
                  COMMENT DELIMITED BY SPACE
                  INTO OUTPUT-RECORD
           WRITE OUTPUT-RECORD.

       UPDATE-TOTAL-AMT.
           ADD OD-AMT TO WS-TOTAL-AMT
           SEARCH WS-DISTINCT-DATE
               WHEN WS-DATE = OD-DATE
                   ADD OD-AMT TO WS-DATE-AMT
               WHEN WS-DATE = SPACES
                   MOVE OD-DATE TO WS-DATE
                   MOVE OD-AMT TO WS-DATE-AMT
           END-SEARCH.

       WRITE-SUMMARY.
           WRITE OUTPUT-RECORD FROM "SUMMARY FOR DIVISION: " WS-CURRENT-DIVISION
           PERFORM VARYING WS-DATE-INDEX FROM 1 BY 1 UNTIL WS-DATE-INDEX > 100
               IF WS-DATE(WS-DATE-INDEX) NOT = SPACES
                   STRING WS-DATE(WS-DATE-INDEX) DELIMITED BY SPACE
                          WS-DATE-AMT(WS-DATE-INDEX) DELIMITED BY SPACE
                          INTO OUTPUT-RECORD
                   WRITE OUTPUT-RECORD
               END-IF
           END-PERFORM.
           WRITE OUTPUT-RECORD FROM "TOTAL AMOUNT: " WS-TOTAL-AMT.
